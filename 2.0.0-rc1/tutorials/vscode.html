<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VSCode integration &mdash; dev-c7 2.0.0-rc1
 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/dls-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Derive your own container image" href="../how-to/deriving.html" />
    <link rel="prev" title="Quick Start" href="start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: rgb(7, 43, 93)" >
            <a href="../index.html" class="icon icon-home"> dev-c7
            <img src="../_static/dls-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0.0-rc1

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">VSCode integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#convince-vscode-to-use-podman">Convince vscode to use podman</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-the-remote-development-plugin">Install the remote development plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-container-config-to-local-repository">add container config to local repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caveat-user-id">Caveat - User ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-enable-the-docker-plugin">Advanced - enable the docker plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-podman-docker">install podman-docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#edit-user-settings">edit user settings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/deriving.html">Derive your own container image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/how_it_works.html">How the dev-c7 container works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/differences.html">RHEL7 native vs dev-c7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/why_dev_c7.html">Purpose of dev-c7 Container</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dls-controls/dev-c7/releases">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: rgb(7, 43, 93)" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">dev-c7</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>VSCode integration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/vscode.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vscode-integration">
<h1>VSCode integration<a class="headerlink" href="#vscode-integration" title="Permalink to this heading"></a></h1>
<p>VSCode has beautiful integration for developing in containers. See here
<a class="reference external" href="https://code.visualstudio.com/docs/remote/containers">https://code.visualstudio.com/docs/remote/containers</a> for a detailed
description of this feature.</p>
<p>To make devcontainers work with podman requires a few extra settings.</p>
<p>I believe this will only work on RHEL8. The earlier version of podman on RHEL7
does not have the correct API.</p>
<section id="convince-vscode-to-use-podman">
<h2>Convince vscode to use podman<a class="headerlink" href="#convince-vscode-to-use-podman" title="Permalink to this heading"></a></h2>
<p>Add the following to
/home/[YOUR USER NAME]/.config/Code/User/settings.json
to make vscode use podman to launch devcontainers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;remote.containers.dockerPath&quot;</span><span class="p">:</span> <span class="s2">&quot;podman&quot;</span>
</pre></div>
</div>
<p>These additional settings ensure that each terminal loads the bash (login)
profile by default.
The login profile includes essential setup for DLS developer environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;terminal.integrated.defaultProfile.linux&quot;</span><span class="p">:</span> <span class="s2">&quot;bash (login)&quot;</span><span class="p">,</span>
<span class="s2">&quot;terminal.integrated.profiles.linux&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;bash (login)&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;-l&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;bash&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="install-the-remote-development-plugin">
<h2>Install the remote development plugin<a class="headerlink" href="#install-the-remote-development-plugin" title="Permalink to this heading"></a></h2>
<p>Run up vscode and install the remote development plugin:</p>
<blockquote>
<div><p>module load vscode
code</p>
</div></blockquote>
<p>Inside vscode:</p>
<blockquote>
<div><p>Ctrl+P
ext install ms-vscode-remote.vscode-remote-extensionpack</p>
</div></blockquote>
</section>
<section id="add-container-config-to-local-repository">
<h2>add container config to local repository<a class="headerlink" href="#add-container-config-to-local-repository" title="Permalink to this heading"></a></h2>
<p>Finally drop the file <code class="docutils literal notranslate"><span class="pre">.devcontainer.json`</span></code> from here
<a class="reference external" href="https://github.com/dls-controls/dev-c7/blob/main/.devcontainer.json">https://github.com/dls-controls/dev-c7/blob/main/.devcontainer.json</a>
into the root folder of a project
and then open that folder with VSCode. You will be prompted to reopen the project
in a container.</p>
<p>Now all the terminals you open in vscode will be inside the container and
all file browsing and launchers will also be in the container.</p>
</section>
<section id="caveat-user-id">
<h2>Caveat - User ID<a class="headerlink" href="#caveat-user-id" title="Permalink to this heading"></a></h2>
<p>Unfortunately run-dev.sh uses –userns=keep-id to give you your native user id
inside and outside of the container. With VSCode integration this starts the
container OK but fails when VSCode tries to exec a service in the container.
Therefore we drop this option in .devcontainer.json and you will run as root
inside the VSCode terminals.</p>
<p>Running as root has minimal side affects, any interaction
with host filesystems will use your own ID (because podman runs in your user
ID). SSH keys will still work but to SSH to another machine you will need
to use the following:
<code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">ssh</span> <span class="pre">your_fed_id&#64;machine_name</span>
<span class="pre">`</span></code></p>
</section>
<section id="advanced-enable-the-docker-plugin">
<h2>Advanced - enable the docker plugin<a class="headerlink" href="#advanced-enable-the-docker-plugin" title="Permalink to this heading"></a></h2>
<p>The docker plugin allows you to manage containers from the explorer in
vscode. This requires access to the docker socket which podman does not have.
However you can make podman look like docker with the following steps.</p>
<p>The docker plugin is here <a class="reference external" href="https://code.visualstudio.com/docs/containers/overview">https://code.visualstudio.com/docs/containers/overview</a></p>
<section id="install-podman-docker">
<h3>install podman-docker<a class="headerlink" href="#install-podman-docker" title="Permalink to this heading"></a></h3>
<p>Execute these commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">podman</span><span class="o">-</span><span class="n">docker</span>
<span class="n">systemctl</span> <span class="o">--</span><span class="n">user</span> <span class="n">enable</span> <span class="o">--</span><span class="n">now</span> <span class="n">podman</span><span class="o">.</span><span class="n">socket</span>
</pre></div>
</div>
</section>
<section id="edit-user-settings">
<h3>edit user settings<a class="headerlink" href="#edit-user-settings" title="Permalink to this heading"></a></h3>
<p>Add the following to  /home/[YOUR USER NAME]/.config/Code/User/settings.json:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;docker.dockerodeOptions&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;socketPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/run/user/[YOUR USER ID]/podman/podman.sock&quot;</span>
<span class="p">},</span>
</pre></div>
</div>
<p>(you can find your uid with the <a class="reference external" href="https://docs.python.org/3/library/functions.html#id" title="(in Python v3.10)"><code class="xref any docutils literal notranslate"><span class="pre">id</span></code></a> command)</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="start.html" class="btn btn-neutral float-left" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../how-to/deriving.html" class="btn btn-neutral float-right" title="Derive your own container image" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   
  <div id="other-versions-div" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" style="visibility: hidden">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Other Versions</span>
      2.0.0-rc1

      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="other-versions-dl"/>
    </div>
  </div>
  <script>
    function addVersion(name) {
      var dd = document.createElement("dd");
      var a = document.createElement("a");
      a.href = "../../" + name;
      a.innerText = name;
      dd.appendChild(a);
      document.getElementById('other-versions-dl').appendChild(dd);
    }
    // Get versions.txt and add a version for each line
    fetch("../../versions.txt").then(response => {
      if (response.ok) {
        document.getElementById('other-versions-div').style.visibility = "visible";
        return response.text().then(text => text.split(/\r?\n/).forEach(addVersion))
      }
    });
  </script>


</body>
</html>